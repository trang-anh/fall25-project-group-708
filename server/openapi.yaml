# openapi.yaml
openapi: 3.1.0
info:
  title: Fake Stack Overflow API
  version: 1.0.0
  description: OpenAPI 3.1 specification for the Fake Stack Overflow backend server.
servers:
  - url: /api
    description: The API server endpoint
paths:
  # --------------------
  # QUESTION CONTROLLER
  # --------------------
  /question/getQuestion:
    get:
      tags:
        - Questions
      summary: Retrieve questions filtered by order, search, and asker.
      parameters:
        - in: query
          name: order
          schema:
            $ref: '#/components/schemas/OrderType'
          required: true
          description: The order in which to sort the questions.
        - in: query
          name: search
          schema:
            type: string
            default: ''
          required: false
          allowEmptyValue: true
          allowReserved: true # removes the requirement that search parameter should be URL encoded.
          description: Search string for questions, can include tags or keywords.
        - in: query
          name: askedBy
          schema:
            type: string
          required: false
          description: Username of the user who asked the question.
      responses:
        '200':
          description: Successfully retrieved filtered list of questions.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedQuestion'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/getQuestionById/{qid}:
    get:
      tags:
        - Questions
      summary: Retrieve a single question by its ID, incrementing its view count.
      parameters:
        - in: path
          name: qid
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the question.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: The username of the viewer to track views.
      responses:
        '200':
          description: Successfully retrieved question details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedQuestion'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/addQuestion:
    post:
      tags:
        - Questions
      summary: Add a new question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewQuestionBody'
      responses:
        '200':
          description: Question successfully added and populated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedQuestion'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/upvoteQuestion:
    post:
      tags:
        - Questions
      summary: Upvote a question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteBody'
      responses:
        '200':
          description: Vote successfully processed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoteResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/downvoteQuestion:
    post:
      tags:
        - Questions
      summary: Downvote a question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteBody'
      responses:
        '200':
          description: Vote successfully processed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoteResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/getCommunityQuestions/{communityId}:
    get:
      tags:
        - Questions
      summary: Retrieve questions for a specific community.
      parameters:
        - in: path
          name: communityId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the community.
      responses:
        '200':
          description: Successfully retrieved list of community questions.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedQuestion'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  
  /question/getQuestionsByTextAndTitle:
    get:
      tags:
        - Questions
      summary: Retrieve up to 5 possible duplicate questions by comparing title and text.
      description: >
        Performs a partial regex-based search on the question title and text to find
        potentially similar or duplicate questions.
      parameters:
        - in: query
          name: title
          schema:
            type: string
            minLength: 1
          required: false
          description: The title of the new question (used for similarity matching).
        - in: query
          name: text
          schema:
            type: string
            minLength: 1
          required: false
          description: The text/body of the new question (used for similarity matching).
      responses:
        '200':
          description: Successfully retrieved a list of up to 5 similar questions.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedQuestion'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # ANSWER CONTROLLER
  # --------------------
  /answer/addAnswer:
    post:
      tags:
        - Answers
      summary: Add a new answer to a specific question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddAnswerBody'
      responses:
        '200':
          description: Answer successfully added. Returns the database answer object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseAnswer'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # TAG CONTROLLER
  # --------------------
  /tags/getTagsWithQuestionNumber:
    get:
      tags:
        - Tags
      summary: Retrieve a list of all tags and the number of questions associated with each.
      responses:
        '200':
          description: Successfully retrieved list of tags and counts.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    qcnt:
                      type: integer
                      minimum: 0
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /tags/getTagByName/{name}:
    get:
      tags:
        - Tags
      summary: Retrieve a single tag by its name.
      parameters:
        - in: path
          name: name
          schema:
            type: string
          required: true
          description: The name of the tag.
      responses:
        '200':
          description: Successfully retrieved tag details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseTag'
        '404':
          description: Tag not found.
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # COMMENT CONTROLLER
  # --------------------
  /comment/addComment:
    post:
      tags:
        - Comments
      summary: Add a new comment to a question or an answer.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddCommentBody'
      responses:
        '200':
          description: Comment successfully added. Returns the database comment object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseComment'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # MESSAGE CONTROLLER
  # --------------------
  /message/addMessage:
    post:
      tags:
        - Messages
      summary: Add a new global message.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddMessageBody'
      responses:
        '200':
          description: Message successfully added. Returns the database message object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseMessage'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /message/getMessages:
    get:
      tags:
        - Messages
      summary: Fetch all global messages.
      responses:
        '200':
          description: Successfully retrieved global messages.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatabaseMessage'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # CHAT CONTROLLER
  # --------------------
  /chat/createChat:
    post:
      tags:
        - Chats
      summary: Create a new chat conversation.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChatBody'
      responses:
        '200':
          description: Chat successfully created. Returns the populated chat object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/{chatId}/addMessage:
    post:
      tags:
        - Chats
      summary: Add a new message to an existing chat.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the chat.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageBody'
      responses:
        '200':
          description: Message successfully added. Returns the updated populated chat object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/{chatId}:
    get:
      tags:
        - Chats
      summary: Retrieve a single chat by its ID.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the chat.
      responses:
        '200':
          description: Successfully retrieved chat details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/{chatId}/addParticipant:
    post:
      tags:
        - Chats
      summary: Add a new participant to an existing chat.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the chat.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddParticipantBody'
      responses:
        '200':
          description: Participant successfully added. Returns the updated database chat object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/getChatsByUser/{username}:
    get:
      tags:
        - Chats
      summary: Retrieve all chats involving a specific user.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username whose chats are being retrieved.
      responses:
        '200':
          description: Successfully retrieved list of chats.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedChat'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # GAME CONTROLLER
  # --------------------
  /games/create:
    post:
      tags:
        - Games
      summary: Create a new game instance.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGameBody'
      responses:
        '200':
          description: Game successfully created. Returns the game ID (string).
          content:
            application/json:
              schema:
                type: string
                description: The ID of the newly created game.
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/join:
    post:
      tags:
        - Games
      summary: Join an existing game.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GameActionBody'
      responses:
        '200':
          description: Player successfully joined. Returns the updated game state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedGame'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/leave:
    post:
      tags:
        - Games
      summary: Leave an existing game.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GameActionBody'
      responses:
        '200':
          description: Player successfully left. Returns the updated game state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedGame'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/games:
    get:
      tags:
        - Games
      summary: Fetch a list of games, optionally filtered by type and status.
      parameters:
        - in: query
          name: gameType
          schema:
            $ref: '#/components/schemas/GameType'
          required: false
          description: Filter games by type (e.g., Nim).
        - in: query
          name: status
          schema:
            $ref: '#/components/schemas/GameStatus'
          required: false
          description: Filter games by status.
      responses:
        '200':
          description: Successfully retrieved list of games.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedGame'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # COLLECTION CONTROLLER
  # --------------------
  /collection/create:
    post:
      tags:
        - Collections
      summary: Create a new collection.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCollectionBody'
      responses:
        '200':
          description: Collection successfully created. Returns the populated collection object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/delete/{collectionId}:
    delete:
      tags:
        - Collections
      summary: Delete a collection by ID.
      parameters:
        - in: path
          name: collectionId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the collection to delete.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: The username of the user performing the deletion (for authorization).
      responses:
        '200':
          description: Collection successfully deleted. Returns the deleted collection object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/toggleSaveQuestion:
    patch:
      tags:
        - Collections
      summary: Add or remove a question from a collection.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToggleSaveQuestionBody'
      responses:
        '200':
          description: Collection successfully updated. Returns the updated populated collection object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/getCollectionsByUsername/{username}:
    get:
      tags:
        - Collections
      summary: Retrieve all collections for a specific user, filtered by privacy.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username whose collections are being viewed.
        - in: query
          name: currentUsername
          schema:
            type: string
          required: true
          description: The username of the currently logged-in user (for permission check).
      responses:
        '200':
          description: Successfully retrieved collections list.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/getCollectionById/{collectionId}:
    get:
      tags:
        - Collections
      summary: Retrieve a single collection by ID, subject to privacy checks.
      parameters:
        - in: path
          name: collectionId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the collection.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: The username of the viewer (for permission check).
      responses:
        '200':
          description: Successfully retrieved collection details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # COMMUNITY CONTROLLER
  # --------------------
  /community/getCommunity/{communityId}:
    get:
      tags:
        - Communities
      summary: Retrieve a community by its ID.
      parameters:
        - in: path
          name: communityId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the community.
      responses:
        '200':
          description: Successfully retrieved community details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseCommunity'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/getAllCommunities:
    get:
      tags:
        - Communities
      summary: Retrieve a list of all communities.
      responses:
        '200':
          description: Successfully retrieved list of communities.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatabaseCommunity'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/toggleMembership:
    post:
      tags:
        - Communities
      summary: Join or leave a community.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToggleMembershipBody'
      responses:
        '200':
          description: Membership status successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseCommunity'
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          description: Forbidden (admin trying to leave the last admin spot).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Community not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/create:
    post:
      tags:
        - Communities
      summary: Create a new community.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommunityBody'
      responses:
        '200':
          description: Community successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseCommunity'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/delete/{communityId}:
    delete:
      tags:
        - Communities
      summary: Delete a community (requires admin privileges).
      parameters:
        - in: path
          name: communityId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the community to delete.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteCommunityBody'
      responses:
        '200':
          description: Community successfully deleted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  community:
                    $ref: '#/components/schemas/DatabaseCommunity'
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Community not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # USER CONTROLLER
  # --------------------
  /user/signup:
    post:
      tags:
        - Users
      summary: Create a new user account.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserSignupBody'
      responses:
        '200':
          description: User successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/login:
    post:
      tags:
        - Users
      summary: Log a user in.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginBody'
      responses:
        '200':
          description: User successfully logged in.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/resetPassword:
    patch:
      tags:
        - Users
      summary: Reset a user's password.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginBody'
      responses:
        '200':
          description: User password successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/getUser/{username}:
    get:
      tags:
        - Users
      summary: Retrieve a user by username.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username of the user to retrieve.
      responses:
        '200':
          description: Successfully retrieved user details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/getUsers:
    get:
      tags:
        - Users
      summary: Retrieve a list of all users.
      responses:
        '200':
          description: Successfully retrieved list of all users.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/deleteUser/{username}:
    delete:
      tags:
        - Users
      summary: Delete a user by username.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username of the user to delete.
      responses:
        '200':
          description: User successfully deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # AUTH CONTROLLER
  # --------------------
  /auth/github:
    get:
      tags:
        - Auth
      summary: Initiate the GitHub OAuth login flow.
      responses:
        '302':
          description: Redirect to GitHub's OAuth consent screen.
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /auth/github/callback:
    get:
      tags:
        - Auth
      summary: Handle the callback from GitHub OAuth.
      parameters:
        - in: query
          name: code
          schema:
            type: string
          required: true
          description: Authorization code returned by GitHub.
        - in: query
          name: state
          schema:
            type: string
          required: false
          allowEmptyValue: true
          description: Optional state returned by GitHub
      responses:
        '302':
          description: Redirects back to the client with the authentication result.
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /auth/user:
    get:
      tags:
        - Auth
      summary: Retrieve the currently authenticated user from the active session.
      responses:
        '200':
          description: Authenticated user information.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: No authenticated session exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'

  /auth/logout:
    post:
      tags:
        - Auth
      summary: Terminate the active remembered session for the current device.
      responses:
        '200':
          description: Session terminated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogoutResponse'
        '401':
          description: No remembered session exists for this device.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'

  /user/updateBiography:
    patch:
      tags:
        - Users
      summary: Update a user's biography.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBiographyBody'
      responses:
        '200':
          description: User biography successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # NOT DUPLICATE QUESTION CONTROLLER
  # --------------------
  /notDuplicateQuestion/saveNotDuplicateQuestion:
    post:
      tags:
        - Not Duplicate Questions
      summary: Save a new "Not Duplicate" justification for a question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveNotDuplicateQuestionBody'
      responses:
        '200':
          description: Justification successfully saved.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseNotDuplicateQuestion'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  
  # --------------------
  # MATCH CONTROLLER
  # --------------------
  /match/getMatch/{matchId}:
    get:
      tags:
        - Match
      summary: Retrieve a match by its ID.
      parameters:
        - in: path
          name: matchId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the match.
      responses:
        '200':
          description: Successfully retrieved match details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Match'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /match/getUserMatches/{userId}:
    get:
      tags:
        - Match
      summary: Retrieve all user matches by user ID.
      parameters:
        - in: path
          name: userId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the user.
      responses:
        '200':
          description: Successfully retrieved all matches details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserMatchesResponse'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /match/create:
    post:
      tags:
        - Match
      summary: Create a new match.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMatchBody'
      responses:
        '200':
          description: Match successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseMatch'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /match/delete/{matchId}:
    delete:
      tags:
        - Match
      summary: Delete a match (requires user privileges).
      parameters:
        - in: path
          name: matchId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the match to delete.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteMatchBody'
      responses:
        '200':
          description: Match successfully deleted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  community:
                    $ref: '#/components/schemas/DatabaseMatch'
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Match not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  
  /match/generate/{userId}:
    post:
      summary: Generate match suggestions for a user
      description: Computes compatibility scores
      tags:
        - Match
      parameters:
        - in: path
          name: userId
          required: true
          description: The ID of the user whose matches will be generated.
          schema:
            type: string
      responses:
        '200':
          description: Matches generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  matches:
                    type: array
                    items:
                      $ref: '#/components/schemas/DatabaseMatch'
                  message:
                    type: string
        '404':
          description: User's match profile not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '500':
          description: Server error during match generation
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  
  # --------------------
  # MATCH PROFILE CONTROLLER
  # --------------------
  /matchProfile/getMatchProfile/{userId}:
    get:
      tags:
        - MatchProfile
      summary: Retrieve a match profile by user ID.
      parameters:
        - in: path
          name: userId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the user.
      responses:
        '200':
          description: Successfully retrieved match profile details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchProfile'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /matchProfile/getAllMatchProfiles:
    get:
      tags:
        - MatchProfile
      summary: Retrieve all match profiles
      responses:
        '200':
          description: Successfully retrieved all match profiles.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchProfilesResponse'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  
  /matchProfile/checkOnboardingStatus/{userId}:
    get:
      tags:
        - MatchProfile
      summary: Check user's onboarding status by their unique ID.
      parameters:
        - in: path
          name: userId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the user.
      responses:
        '200':
          description: Successfully retrieved onboarding status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchProfile'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  
  /matchProfile/toggleMatchProfileActive/{userId}:
    patch:
      tags:
        - MatchProfile
      summary: Deactivate or reactivate a match profile.
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: object-id
          description: The unique ID of the user whose active status is being toggled.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToggleMatchProfileActiveBody'
      responses:
        '200':
          description: Active status successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseMatchProfile'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          description: Match Profile not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  
  /matchProfile/updateMatchProfile/{userId}:
    patch:
      tags:
        - MatchProfile
      summary: Update a user's match profile.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMatchProfileBody'
      responses:
        '200':
          description: User match profile successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchProfile'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  
  /matchProfile/create:
    post:
      tags:
        - MatchProfile
      summary: Create a new match.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMatchProfileBody'
      responses:
        '200':
          description: Match Profile successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseMatchProfile'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'



components:
  schemas:
    # --------------------
    # CORE UTIL SCHEMAS
    # --------------------
    OrderType:
      type: string
      enum:
        - newest
        - unanswered
        - active
        - mostViewed
      default: 'newest'

    VoteResponse:
      type: object
      properties:
        msg:
          type: string
        upVotes:
          type: array
          items:
            type: string
        downVotes:
          type: array
          items:
            type: string

    # --------------------
    # QUESTION SCHEMAS
    # --------------------
    VoteBody:
      type: object
      required:
        - qid
        - username
      properties:
        qid:
          type: string
          description: Unique identifier of the question.
        username:
          type: string
          description: Username of the user casting the vote.

    TagBody:
      type: object
      required:
        - name
        - description
      properties:
        name:
          type: string
          minLength: 1
          description: The name of the tag.
        description:
          type: string
          minLength: 1
          description: A brief description of the tag's purpose or usage.

    NewQuestionBody:
      type: object
      required:
        - title
        - text
        - tags
        - askedBy
        - askDateTime
      properties:
        title:
          type: string
          minLength: 1
        text:
          type: string
          minLength: 1
        tags:
          type: array
          items:
            $ref: '#/components/schemas/TagBody'
          minItems: 1
          description: Array of Tag objects, each requiring a name and description.
        askedBy:
          type: string
          minLength: 1
        askDateTime:
          type: string
          format: date-time
        community:
          type: string
          format: object-id
          nullable: true

    PopulatedQuestion:
      type: object
      description: A fully populated question object with embedded tags, answers, and comments.

    # --------------------
    # ANSWER SCHEMAS
    # --------------------
    AnswerBody:
      type: object
      required:
        - text
        - ansBy
        - ansDateTime
      properties:
        text:
          type: string
          minLength: 1
        ansBy:
          type: string
          minLength: 1
        ansDateTime:
          type: string
          format: date-time

    AddAnswerBody:
      type: object
      required:
        - qid
        - ans
      properties:
        qid:
          type: string
          format: object-id
          description: The ID of the question the answer belongs to.
        ans:
          $ref: '#/components/schemas/AnswerBody'

    DatabaseAnswer:
      type: object
      description: An answer object as stored in the database.

    # --------------------
    # TAG SCHEMAS
    # --------------------
    DatabaseTag:
      type: object
      description: A tag object as stored in the database.

    # --------------------
    # COMMENT SCHEMAS
    # --------------------
    CommentBody:
      type: object
      required:
        - text
        - commentBy
        - commentDateTime
      properties:
        text:
          type: string
          minLength: 1
        commentBy:
          type: string
          minLength: 1
        commentDateTime:
          type: string
          format: date-time

    AddCommentBody:
      type: object
      required:
        - id
        - type
        - comment
      properties:
        id:
          type: string
          format: object-id
          description: The ID of the parent (question or answer).
        type:
          type: string
          enum:
            - question
            - answer
          description: The type of document the comment is attached to.
        comment:
          $ref: '#/components/schemas/CommentBody'

    DatabaseComment:
      type: object
      description: A comment object as stored in the database.

    # --------------------
    # MESSAGE SCHEMAS
    # --------------------
    MessageBody:
      type: object
      required:
        - msg
        - msgFrom
        - msgDateTime
      properties:
        msg:
          type: string
          minLength: 1
        msgFrom:
          type: string
          minLength: 1
        msgDateTime:
          type: string
          format: date-time

    AddMessageBody:
      type: object
      required:
        - messageToAdd
      properties:
        messageToAdd:
          $ref: '#/components/schemas/MessageBody'

    DatabaseMessage:
      type: object
      description: A message object as stored in the database.

    # --------------------
    # CHAT SCHEMAS
    # --------------------
    CreateChatBody:
      type: object
      required:
        - participants
        - messages
      properties:
        participants:
          type: array
          minItems: 1
          items:
            type: string
        messages:
          type: array
          items:
            $ref: '#/components/schemas/MessageBody'

    AddParticipantBody:
      type: object
      required:
        - username
      properties:
        username:
          type: string
          description: The username of the new participant.

    PopulatedChat:
      type: object
      description: A fully populated chat object with embedded messages.

    # --------------------
    # GAME SCHEMAS
    # --------------------
    GameType:
      type: string
      enum: # Based on known game types like 'Nim'
        - Nim
        - TBD_OtherGame
      description: The type of game to create.

    GameStatus:
      type: string
      enum:
        - WAITING_TO_START
        - IN_PROGRESS
        - OVER
      description: The status of the game.

    CreateGameBody:
      type: object
      required:
        - gameType
      properties:
        gameType:
          $ref: '#/components/schemas/GameType'

    GameActionBody:
      type: object
      required:
        - gameID
        - playerID
      properties:
        gameID:
          type: string
          format: object-id
        playerID:
          type: string

    PopulatedGame:
      type: object
      description: A fully populated game instance object.

    # --------------------
    # COLLECTION SCHEMAS
    # --------------------
    CreateCollectionBody:
      type: object
      required:
        - name
        - description
        - questions
        - username
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
          minLength: 1
        questions:
          type: array
          items:
            type: string
            format: object-id
        username:
          type: string
          minLength: 1
        isPrivate:
          type: boolean
          default: false

    ToggleSaveQuestionBody:
      type: object
      required:
        - collectionId
        - questionId
        - username
      properties:
        collectionId:
          type: string
          format: object-id
        questionId:
          type: string
          format: object-id
        username:
          type: string

    PopulatedCollection:
      type: object
      description: A fully populated collection object.

    # --------------------
    # COMMUNITY SCHEMAS
    # --------------------
    CommunityVisibility:
      type: string
      enum:
        - PUBLIC
        - PRIVATE

    ToggleMembershipBody:
      type: object
      required:
        - communityId
        - username
      properties:
        communityId:
          type: string
          format: object-id
        username:
          type: string

    CreateCommunityBody:
      type: object
      required:
        - name
        - description
        - admin
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
          minLength: 1
        admin:
          type: string
          minLength: 1
        visibility:
          $ref: '#/components/schemas/CommunityVisibility'
          default: PUBLIC
        participants:
          type: array
          items:
            type: string
          default: []

    DeleteCommunityBody:
      type: object
      required:
        - username
      properties:
        username:
          type: string
          minLength: 1
          description: The username of the admin performing the deletion.

    DatabaseCommunity:
      type: object
      description: A community object as stored in the database.

    # --------------------
    # USER SCHEMAS
    # --------------------
    UserSignupBody:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 1
        password:
          type: string
          minLength: 1
        email:
          type: string
          format: email
          nullable: true
          description: Optional user email.
        biography:
          type: string
          default: ''
          description: Optional user biography.
        githubId: 
          type: string
          nullable: true
          description: Github ID for OAuth users 

    UserLoginBody:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 1
        password:
          type: string
          minLength: 1
        rememberDevice:
          type: boolean
          default: false
          description: Set to true to persist the login session on this device.

    UpdateBiographyBody:
      type: object
      required:
        - username
        - biography
      properties:
        username:
          type: string
          minLength: 1
        biography:
          type: string

    User:
      type: object
      description: A user profile object.

    SimpleErrorBody: # MODIFICATION: New schema for simple JSON errors like 403, 404
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: A detailed error message.
    LogoutResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Confirmation message when a session is cleared.
      
    # --------------------
    # NOT DUPLICATE QUESTION SCHEMAS
    # --------------------
    SaveNotDuplicateQuestionBody:
      type: object
      required:
        - username
        - question
        - duplicateOf
        - justification
        - createdAt
      properties:
        username:
          type: string
          minLength: 1
        question:
          type: string
          format: object-id
        duplicateOf:
          type: array
          items:
            type: string
            format: object-id
        justification:
          type: string
          minLength: 0
        createdAt:
          type: string
          format: date-time

    DatabaseNotDuplicateQuestion:
      type: object
      description: Not-duplicate justification record as stored in MongoDB.
      properties:
        _id:
          type: string
          format: object-id
        username:
          type: string
        question:
          type: string
          format: object-id
        duplicateOf:
          type: array
          items:
            type: string
            format: object-id
        justification:
          type: string
        createdAt:
          type: string
          format: date-time

    # --------------------
    # MATCH SCHEMAS
    # --------------------
    Match:
      type: object
      properties:
        _id:
          type: string
          description: Unique identifier for the match
          example: 653b2c2ef5b7c70012a34d93
        userA:
          type: string
          description: ObjectId of the first user
        userB:
          type: string
          description: ObjectId of the second user
        status:
          type: string
          enum: 
          - pending
          - accepted
          - rejected
          description: Match status
        score:
          type: number
          format: float
          description: Match score
        initiatedBy:
          type: string
          description: ObjectId of the user who initiated the match
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the match was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the match was last updated
    
    CreateMatchBody:
      type: object
      required:
        - userA
        - userB
        - initiatedBy
      properties:
        userA:
          type: string
          description: ObjectId of the first user in the match
          minLength: 1
        userB:
          type: string
          description: ObjectId of the second user in the match
          minLength: 1
        status:
          type: string
          enum: 
          - pending
          - accepted
          - rejected
          default: pending
          description: Current status of the match
        score:
          type: number
          format: float
          description: Compatibility score between the two users
        initiatedBy:
          type: string
          description: ObjectId of the user who initiated the match

    DeleteMatchBody:
      type: object
      required:
        - userId
      properties:
        userId:
          type: string
          minLength: 1
          description: The user id of the user performing the deletion.

    DatabaseMatch:
      allOf:
        - $ref: '#/components/schemas/Match'
      description: A match object as stored in the database.

    UserMatchesResponse:
      type: array
      items:
        type: object
        properties:
          _id:
            type: string
          userA:
            type: string
          userB:
            type: string
          status:
            type: string
          score:
            type: number
  
    # --------------------
    # MATCH PROFILE SCHEMAS
    # --------------------
    MatchProfile:
      type: object
      properties:
        userId:
          type: string
          description: Unique identifier for the match profile
        isActive:
          type: boolean
          description: Boolean indicicating active in service or not
        age:
          type: integer
          description: Age of user
        gender:
          type: string
          enum: 
          - MALE
          - FEMALE
          - NON-BINARY
          - PREFER TO NOT DESCRIBE
          description: gender of user
        location:
          type: string
          enum:
          - NORTH AMERICA
          - SOUTH AMERICA
          - EUROPE
          - ASIA
          - AFRICA
          - AUSTRALIA
          - ANTARCTICA
          description: location of user
        programmingLanguage:
          type: array
          description: Array of ObjectIds referencing programming languages known by the user.
          items:
            type: string
            format: object-id
        level:
          type: string
          enum: 
          - BEGINNER
          - INTERMEDIATE
          - ADVANCED
          description: user's self-assessed programming level
        preferences:
          type: object
          description: user's preferred criteria when matching with others
          properties:
            preferredLanguages:
              type: array
              description: Array of ObjectIds referencing preferred programming languages.
              items:
                type: string
                format: object-id
            preferredLevel:
              type: string
              enum: 
              - BEGINNER
              - INTERMEDIATE
              - ADVANCED
              description: Preferred experience level of the matching user
        onboardingAnswers:
          type: object
          description: Optional onboarding quiz answers provided by the user
          properties:
            goals:
              type: string
              description: user's personal goals for pair programming
            personality:
              type: string
              description: description of the users personality or working style
            projectType:
              type: string
              description: type of project user prefers.
        biography:
          type: string
          description: Short bio written by the user
        profileImageUrl:
          type: string
          description: Optional URL to the users profile image
        createdAt:
          type: string
          format: date-time
          description: Timestamp when match profile was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when match profile was last updated
    
    CreateMatchProfileBody:
      type: object
      required:
        - userId
        - gender
        - level
      properties:
        userId:
          type: string
          description: Unique identifier for the match profile
          minLength: 1
        gender:
          type: string
          enum: 
          - MALE
          - FEMALE
          - NON-BINARY
          - PREFER TO NOT DESCRIBE
          description: gender of user
          minLength: 1
        level:
          type: string
          enum: 
          - BEGINNER
          - INTERMEDIATE
          - ADVANCED
          description: user's self-assessed programming level
    
    ToggleMatchProfileActiveBody:
      type: object
      required:
        - userId
        - isActive
      properties:
        userId:
          type: string
          description: The ID of the user whose profile is being toggled
        isActive:
          type: boolean
          description: New active status for the user.
      
    UpdateMatchProfileBody:
      type: object
      description: Request body for updating an existing match profile. All fields are optional except userId
      required:
        - userId
      properties:
        userId:
          type: string
          format: object-id
          description: The ID of the user whose match profile is being updated
        isActive:
          type: boolean
          description: Whether the user's match profile is currently active
        age:
          type: integer
          description: Updated age of the user
        gender:
          type: string
          enum: 
          - MALE
          - FEMALE
          - NON-BINARY
          - PREFER TO NOT DESCRIBE
          description: Updated gender identity
        location:
          type: string
          enum:
            - NORTH AMERICA
            - SOUTH AMERICA
            - EUROPE
            - ASIA
            - AFRICA
            - AUSTRALIA
            - ANTARCTICA
          description: Updated location or region of the user
        programmingLanguage:
          type: array
          description: Updated list of programming languages (ObjectIds) for the user
          items:
            type: string
            format: object-id
        level:
          type: string
          enum: 
          - BEGINNER
          - INTERMEDIATE
          - ADVANCED
          description: Updated programming experience level
        preferences:
          type: object
          description: Updated user preferences for matching
          properties:
            preferredLanguages:
              type: array
              items:
                type: string
                format: object-id
              description: Updated preferred programming languages
            preferredLevel:
              type: string
              enum: 
              - BEGINNER
              - INTERMEDIATE
              - ADVANCED
              description: Updated preferred partner level
        onboardingAnswers:
          type: object
          description: Updated onboarding quiz responses
          properties:
            goals:
              type: string
              description: Updated personal goals
            personality:
              type: string
              description: Updated self-description or personality type
            projectType:
              type: string
              description: Updated preferred project type
        biography:
          type: string
          description: Updated user biography or profile description
        profileImageUrl:
          type: string
          description: Updated URL for the users profile picture
    
    DatabaseMatchProfile:
      allOf:
        - $ref: '#/components/schemas/MatchProfile'
      description: A match object as stored in the database

    MatchProfilesResponse:
      type: array
      items:
        type: object
        properties:
          userId:
            type: string
          isActive:
            type: boolean
          age:
            type: string
          gender:
            type: string
          location:
            type: string
          programmingLanguage:
            type: array
          level: 
            type: string
          preferences:
            type: object
          onboardingAnswers:
            type: object
          biography:
            type: string
          profileImageUrl:
            type: string

  responses:
    # --------------------
    # RESPONSE SCHEMAS
    # --------------------
    ErrorResponse:
      description: Internal Server Error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: The error message returned by the server.
    ValidationError:
      description: Bad Request / Validation Error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: The error message from express-openapi-validator.
              errors:
                type: array
                description: Detailed list of validation errors.
